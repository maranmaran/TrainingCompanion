<ng-container id="exercise-type-create-edit">

  <h2 mat-dialog-title> {{data.title}} </h2>
  <mat-divider class="dialog-form-divider"></mat-divider>

  <div mat-dialog-content class="form" fxLayout="column">
    <form [formGroup]="form">

      <!--FIELDS-->
      <mat-form-field>
        <input matInput formControlName="name" placeholder="Name">
        <mat-error *ngIf="name?.invalid"></mat-error>
      </mat-form-field>

      <!--CHECKBOXES-->
      <div class="checkboxes-wrapper" fxLayout="row" fxLayoutAlign="space-evenly">
        <div id="group1" fxLayout="column">
          <mat-checkbox formControlName="requiresWeight" [name]="'weight'" (change)="onCheckboxChange($event)">Weight
          </mat-checkbox>
          <mat-checkbox formControlName="requiresReps" [name]="'reps'" (change)="onCheckboxChange($event)">Reps
          </mat-checkbox>
          <mat-checkbox formControlName="requiresSets">Sets</mat-checkbox>
        </div>
        <div id="group2" fxLayout="column">
          <mat-checkbox formControlName="active">Active</mat-checkbox>
          <mat-checkbox formControlName="requiresBodyweight" [name]="'bodyweight'" (change)="onCheckboxChange($event)">
            Bodyweight only</mat-checkbox>
          <mat-checkbox formControlName="requiresTime" [name]="'time'" (change)="onCheckboxChange($event)">Measure time
          </mat-checkbox>
        </div>
      </div>

      <!--TAGS-->
      <mat-accordion [displayMode]="'flat'" [multi]="false" fxLayout="row wrap" fxLayout.lt-sm="column" class="tags"
        [@.disabled]="disableAnimation">
        <ng-container *ngFor="let tagGroup of tagGroups">

          <!-- works -->
          <mat-expansion-panel fxFlex="1 1 50%" fxFlex.lt-sm="1 1 100%">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <app-exercise-type-chip [value]="tagGroup.type" [backgroundColor]="tagGroup.hexBackground"
                  [color]="tagGroup.hexColor">
                </app-exercise-type-chip>
              </mat-panel-title>
              <mat-panel-description fxLayout="row" fxLayoutAlign="end">
                <mat-checkbox id="master-show-checkbox" (click)="$event.stopPropagation()" [name]="tagGroup.id">
                </mat-checkbox>
                <span id="master-show-checkbox-label">Don't display</span>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <!--assigned properties-->
            <ng-container *ngFor="let property of getEntityTags(tagGroup.id); trackBy: trackByFn">
              <ng-container *ngTemplateOutlet="propertyTemplate; context: { property: property }"></ng-container>
            </ng-container>

            <ng-container *ngTemplateOutlet="newPropertyTemplate; context: { tagGroupId: tagGroup.id }"></ng-container>

          </mat-expansion-panel>

          <!-- does not work properly with mat-accordion -->
          <!-- <ng-container *ngTemplateOutlet="tagGroupTemplate; context: { tagGroup: tagGroup }"></ng-container> -->

        </ng-container>
      </mat-accordion>

    </form>
  </div>

  <div mat-dialog-actions class="mt-2 dialog-form-actions" fxLayout="row" fxLayoutAlign="space-between">
    <button mat-button color="accent" mat-dialog-close>Close</button>
    <button mat-stroked-button color="primary" (click)="onSubmit()"
      [disabled]="!form.valid">{{ data.action == 'Create' ? 'Add' : 'Save' }}</button>
  </div>
</ng-container>

<ng-template #propertyTemplate let-property="property">
  <div fxLayout="row" fxLayoutAlign="space-between center">
    <span>{{property.tag.value}}</span>

    <span id="actions">
      <mat-checkbox id="show-checkbox" [checked]="property.show" matTooltip="Display this tag in the exercise type details"></mat-checkbox>
      <button mat-icon-button color="accent" (click)="removeTag()">
          <i class="fas fa-times"></i>
      </button>
    </span>
  </div>
</ng-template>

<ng-template #newPropertyTemplate let-groupId="tagGroupId">
  <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="5px">
    <mat-form-field>
      <mat-label>Add tag</mat-label>
      <mat-select>
          <mat-option *ngFor="let property of getGroupTags(groupId)" [value]="property">
              {{ property.value }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <!-- <mat-checkbox fxLayout="column" fxLayoutAlign="center" id="show-checkbox">Show</mat-checkbox> -->
  </div>
</ng-template>

<!-- not working with mat-accordion -->
<!-- <ng-template #tagGroupTemplate let-tagGroup="tagGroup">
  <mat-expansion-panel fxFlex="1 1 50%" fxFlex.lt-sm="1 1 100%">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <app-exercise-type-chip [value]="tagGroup.type" [backgroundColor]="tagGroup.hexBackground"
          [color]="tagGroup.hexColor">
        </app-exercise-type-chip>
      </mat-panel-title>
      <mat-panel-description fxLayout="row" fxLayoutAlign="end">
        <mat-checkbox id="master-show-checkbox" (click)="$event.stopPropagation()" [name]="tagGroup.id"></mat-checkbox>
        <span id="master-show-checkbox-label">Don't display</span>
      </mat-panel-description>
    </mat-expansion-panel-header>
    <ng-container *ngFor="let property of getProperties(tagGroup.id); trackBy: trackByFn">
      <ng-container *ngTemplateOutlet="propertyTemplate; context: { property: property }"></ng-container>
    </ng-container>
  </mat-expansion-panel>
</ng-template> -->
