<mat-toolbar color="primary" class="toolbar-navigation-bar no-padding" fxLayout="row" [fxLayoutAlign]="userInfo.isAthlete ? 'end center' : 'space-between center'">

  <div id="left" *ngIf="!userInfo.isAthlete" fxLayout="row wrap" fxLayoutAlign="center center">

    <button mat-icon-button (click)="onToggleSidebar()">
      <i class="fas fa-bars fa-lg"></i>
    </button>

    <!--Impersonate feature..-->
    <span *ngIf="userInfo.isCoach" class="toolbar-title">{{ userInfo.fullName }}</span>

  </div>

  <div id="right" fxLayout="row wrap" fxLayoutGap="1rem" fxLayoutAlign="center center">

    <!--MESSENGER-->
    <i id="messaging" routerLink="/app/chat" class="fas fa-comments"
    [matBadge]="(unreadChatMessages | async)"
    matBadgeColor="accent"
    [matBadgeHidden]="(unreadChatMessages | async) == 0"></i>

    <!--NOTIFICATIONS-->
    <i id="notifications" class="fas fa-bell" matBadge="{{unreadNotificationCounter}}"
      matBadgeHidden="{{unreadNotificationCounter == 0}}" matBadgeColor="warn"
      [matMenuTriggerFor]="notificationsMenu"></i>


      <mat-menu #notificationsMenu="matMenu" class="notifications-menu-container">

        <!--BUG with mat menu integration https://github.com/angular/components/issues/10122 -->
        <!-- <cdk-virtual-scroll-viewport class="virtual-scroll-viewport" itemSize="{{60}}" minBufferPx="{{60 * 3}}" maxBufferPx="{{60 * 3 * 3}}" (scrolledIndexChange)="loadMoreNotifications($event)">
            <div *cdkVirtualFor="let item of notifications; let i = index; let c = count" class="virtual-scroll-item">
               <app-notification-item [model]="item" (clickEvent)="notificationClicked($event)"></app-notification-item>
               <mat-divider *ngIf="!(i + 1 == c - 1)"></mat-divider>
            </div>
            <button classy="w-100 mt-3" mat-stroked-button color="primary" (click)="loadMoreNotifications()" (click)="$event.stopPropagation()">Show more notifications</button>
          </cdk-virtual-scroll-viewport> -->

          <p id="no-notifications" fxLayout="row" fxLayoutAlign="center" *ngIf="!notifications || notifications.length == 0">
            <i>No notifications to show</i>
          </p>

          <div id="notification-item-wrapper" *ngIf="notifications && notifications.length > 0">

            <div *ngFor="let item of notifications; let i = index; let c = count" class="virtual-scroll-item">
              <app-notification-item
                [model]="item"
                (click)="$event.stopPropagation()"
                (click)="onClickNotification(item)"
                (mouseover)="!item.read ? onHoverNotification(item) : ''"
              ></app-notification-item>
              <mat-divider *ngIf="!(i + 1 == c)"></mat-divider>
            </div>

          </div>

           <button class="w-100" *ngIf="!stopFetch" mat-stroked-button color="primary" (click)="$event.stopPropagation()" (click)="loadMoreNotifications()" >Show more notifications</button>

    </mat-menu>

    <!--AVATAR-->
    <!-- <ngx-avatar size="40" name="{{ fullName }}"></ngx-avatar> -->
    <img class="img-fluid avatar-img" src="{{ userInfo.avatar }}"  [matMenuTriggerFor]="userMenu" style="max-width: 40px; cursor: pointer;"/>

    <mat-menu #userMenu="matMenu">

      <div class="container" fxLayout="column wrap">

        <div id="avatar-settings-row" fxFlexAlign="end">
          <button mat-icon-button (click)="onOpenSettings()">
            <i id="settings" class="fas fa-cog"></i>
          </button>
        </div>

        <div id="avatar-content-row" fxFlexAlign="center">
          <img id="content-avatar" class="img-fluid avatar-img" src="{{ userInfo.avatar }}" style="width: 100px; cursor: pointer;"/>
        </div>

        <div id="avatar-actions-row" fxLayout="row wrap" fxLayoutGap="3rem" fxLayoutAlign="space-between center">
          <button mat-stroked-button routerLink="">
            Homepage
          </button>
          <button id="logout" (click)="onLogout()" mat-button color="accent">
            Sign out
          </button>
        </div>
      </div>

    </mat-menu>
  </div>

</mat-toolbar>

<ng-container *ngIf="(loading$ | async)">
  <mat-progress-bar class="loading-bar" mode="indeterminate" color="accent"></mat-progress-bar>
</ng-container>
